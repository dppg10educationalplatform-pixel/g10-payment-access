<!DOCTYPE html>
<html>
<head>
  <title>Verifying Payment</title>
</head>
<body>

<h3>Verifying payment...</h3>

<script>
const data = JSON.parse(localStorage.getItem("paymentData"));

if (!data) {
  alert("No payment data");
  location.href = "payment.html";
}

fetch("/verify-payment", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(data)
})
.then(res => res.json())
.then(result => {
  if (result.success) {
    const expiry = Date.now() + 365 * 24 * 60 * 60 * 1000;
    localStorage.setItem("accessExpiry", expiry);
    location.href = "protected.html";
  } else {
    alert("Payment verification failed");
    location.href = "payment.html";
  }
});
</script>

</body>
</html>
